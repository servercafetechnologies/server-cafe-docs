# 3.2 Workflow Execution

Workflow execution defines how requests move through the Server Café orchestration layers (Dawn, Day, Dusk) under continuous HITL oversight. This section provides explicit, step-by-step instructions for processing requests, integrating human review, and producing compliance-ready outputs.

---

## 3.2.1 Request Ingestion (Dawn)

**Objective:** Validate, sanitize, and authenticate all incoming requests before they reach vendor AIs.

**Procedure:**
1. Incoming request received via API gateway.
2. Dawn performs input checks:
   - **Authentication:** Validate API key, IP whitelist, and token expiry.
   - **Data Sanitation:** Run regex filters for injection attempts, profanity, or disallowed PII.
   - **Compliance Check:** Apply GDPR/HIPAA filters for sensitive data.
   - **Bias Pre-Screen:** ML-based scan for culturally biased language.
3. If request passes:
   - Forward to Day layer for consensus routing.
4. If request fails:
   - Generate rejection response.
   - Log incident in YAML with reason code.

**Sample Log Entry:**
```yaml
message_type: dawn_validation
from: Dawn
stack: us
purpose: input_screening
payload:
  request_id: 553920
  validation_status: failed
  reason: "GDPR: Detected personal health data without consent token"
  timestamp: 2025-08-22T16:30:00Z
```

**Deliverable:** A **Validation Log Archive** maintained daily.

---

## 3.2.2 Consensus Routing (Day)

**Objective:** Distribute validated requests to multiple vendor AIs, collect outputs, and prepare for HITL arbitration.

**Procedure:**
1. Load-balancer assigns request to at least 3 vendor AIs (e.g., OpenAI, Claude, Gemini).
2. Vendor outputs collected and scored on:
   - Confidence score (from vendor metadata).
   - Alignment with policy filters.
   - Consistency with peer outputs.
3. Divergences flagged when outputs differ beyond threshold (≥ 20% semantic variance).
4. Outputs bundled with divergence score and forwarded to HITL console.

**Deliverable:** A **Consensus Routing Report** documenting vendor usage, divergence rates, and load balancing statistics.

---

## 3.2.3 HITL Arbitration

**Objective:** Resolve divergences and bias flags through human review.

**Procedure:**
1. Operator receives flagged case in console.
2. Compare vendor outputs side by side.
3. Review system-generated bias annotations.
4. Decide outcome:
   - Approve consensus result (if aligned).
   - Modify output (record rationale).
   - Reject and escalate (Tier 2 or 3).
5. Record decision in YAML log.

**Sample Log Entry:**
```yaml
message_type: hitl_arbitration
from: HITL_Operator_204
stack: global
purpose: divergence_resolution
payload:
  case_id: 99102
  decision: approved
  rationale: "Outputs aligned within variance threshold"
  timestamp: 2025-08-22T16:45:00Z
```

**Deliverable:** An **Arbitration Activity Report** with case counts, resolution types, and average arbitration times.

---

## 3.2.4 Compliance Synthesis (Dusk)

**Objective:** Generate the final output, ensuring it meets compliance and quality standards.

**Procedure:**
1. Dusk layer receives operator-approved or escalated decision.
2. Verify against compliance libraries:
   - GDPR (privacy, data minimization).
   - HIPAA (protected health information).
   - SOX (financial reporting integrity).
   - NATO standards (for classified contexts).
3. Append YAML-stamped compliance certificate to output package.
4. Store complete audit log (Dawn → Day → HITL → Dusk) in immutable archive.
5. Deliver final output to requester.

**Sample Log Entry:**
```yaml
message_type: dusk_compliance
from: Dusk
stack: nato
purpose: output_synthesis
payload:
  request_id: 553920
  compliance_status: pass
  certificate_id: C-2025-8845
  timestamp: 2025-08-22T17:00:00Z
```

**Deliverable:** A **Compliance Synthesis Log** with certificate IDs, compliance checks passed, and output delivery confirmation.

---

## 3.2.5 Workflow Performance Metrics

**Objective:** Track performance across the entire Dawn–Day–Dusk cycle.

**Metrics:**
- Average request latency (target: < 200 ms internal).
- Arbitration time per case (target: < 45 seconds).
- Escalation ratio (target: < 5%).
- Compliance pass rate (target: 100%).

**Deliverable:** A **Workflow Metrics Report** issued daily with trend analysis.

---

## 3.2.6 Final Approval

**Objective:** Confirm that workflow execution procedures are functioning as designed.

**Procedure:**
- Review Validation Log Archive, Consensus Routing Report, Arbitration Activity Report, and Compliance Synthesis Log.
- Compare daily Workflow Metrics Report against SLA targets.
- Obtain approval from Operations Lead and Compliance Officer.

**Deliverable:** A signed **Workflow Execution Approval Certificate**, required for continuous operations and regulatory audits.

---
